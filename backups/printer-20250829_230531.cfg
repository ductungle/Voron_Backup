#####################################################################
#   Device ID's
#####################################################################
[mcu rpi]
serial: /tmp/klipper_host_mcu
[include fluidd.cfg]

#####################################################################
#   Happy Hare includes
#####################################################################
#[include mmu/addons/mmu_erec_cutter.cfg]
#[include mmu/base/*.cfg]
#[include mmu/optional/client_macros.cfg]
##[include mmu/optional/mmu_ercf_compat.cfg]
#[include mmu/optional/mmu_menu.cfg]
#[include mmu/addons/blobifier.cfg]
#include mmu/base/mmu_filametrix.cfg]

#####################################################################
#   Configs
#####################################################################
[include configs/sb2209USB.cfg]
[include configs/cartographer.cfg]

#####################################################################
#   Includes
#####################################################################
[include print_area_bed_mesh.cfg]
#[include autoZ.cfg]

[exclude_object] 



[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_0F002B000650534841313020-if00
[input_shaper]
#shaper_freq_x: 61
#shaper_type_x: mzv
#shaper_freq_y: 39
#shaper_type_y: mzv
shaper_freq_x: 77
shaper_type_x: 2hump_ei
shaper_freq_y: 47
shaper_type_y: 2hump_ei

#####################################################################
#   Basic Klipper and Printer setup
#####################################################################

[printer]
kinematics: corexy
max_velocity: 300  
max_accel: 3000  			   #Max 4000
max_z_velocity: 15 			#Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0


[idle_timeout]
timeout: 1800

[force_move]
enable_force_move: True

#####################################################################
#   Includes
#####################################################################

[include configs/steppers.cfg]
[include configs/temperature_sensors.cfg]
[include configs/fans.cfg]
[include configs/leds.cfg]
[include configs/display.cfg]

#####################################################################
# 	Macros
#####################################################################

[include macros/print_start_end.cfg]
[include macros/clean_nozzle.cfg]



[gcode_macro CLEAN_DA_NOZZLE]
variable_start_x: 67
variable_start_y: 300
variable_start_z: 4
variable_wipe_dist: 20
variable_wipe_qty: 10
variable_wipe_spd: 200
variable_raise_distance: 10

gcode:
 {% if "xyz" not in printer.toolhead.homed_axes %}
   G28
 {% endif %}
 
 G90                                            ; absolute positioning
 ## Move nozzle to start position
 G1 X{start_x} Y{start_y} F6000
 G1 Z{start_z} F1500

 ## Wipe nozzle
 {% for wipes in range(1, (wipe_qty + 1)) %}
   G1 X{start_x + wipe_dist} F{wipe_spd * 60}
   G1 X{start_x} F{wipe_spd * 60}
 {% endfor %}

 ##m Move nozzle in y t prevent hitting klicky
 G1 Y{270}

 ## Raise nozzle
 G1 Z{raise_distance}


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################


[safe_z_home]
##	XY Location of the Z Endstop Switch
##	Update -10,-10 to the XY coordinates of your endstop pin 
##	(such as 157,305) after going through Z Endstop Pin
##	Location Definition step.
home_xy_position    :150, 150
speed               :300
z_hop               :10
z_hop_speed         :10.0


[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
##	MAX (250, 250), (300,300), or (350,350) depending on your printer size
##	to respective belt positions

#--------------------------------------------------------------------
##	Gantry Corners for 300mm Build
##	Uncomment for 300mm build
gantry_corners:
	-60,-10
	360,370
##	Probe points
points:
	50,25
	50,225
	250,225
	250,25
#--------------------------------------------------------------------
speed: 500
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>



#--------------------------------------------------------------------


#####################################################################
# 	Macros
#####################################################################
#[bed_mesh]
#speed: 300
#horizontal_move_z: 20
#mesh_min: 40, 40
#mesh_max: 260,260
#fade_start: 0.6
#fade_end: 10.0
#probe_count: 5,5
#algorithm: bicubic
#relative_reference_index: 12
#zero_reference_position: 150, 150



[include moonraker_obico_macros.cfg]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 58.566
#*# pid_ki = 3.337
#*# pid_kd = 256.959
#*#
#*# [extruder]
#*#
#*# [stepper_z]
#*# position_endstop = -1.740
#*#
#*# [probe]
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.005289, -0.005429, 0.014205, 0.015818, 0.000032, 0.001670, 0.021152, 0.012430, 0.004465, 0.022058, 0.021258, 0.001823, 0.001870, 0.021152, 0.009080, 0.000060, 0.018158, 0.016261, -0.002261, -0.001742, 0.018173, 0.009767, 0.000897, 0.016191, 0.015828, -0.003524, -0.003513, 0.012709, 0.005789, -0.001803
#*# 	-0.010693, 0.000731, 0.011154, 0.005260, -0.002049, 0.017775, 0.019743, 0.001828, 0.011471, 0.019544, 0.000088, 0.000752, 0.019376, 0.009389, -0.001681, 0.006552, 0.015875, -0.005410, -0.007016, 0.014050, 0.014192, -0.004510, 0.004697, 0.012846, -0.007401, -0.006924, 0.014078, 0.015846, -0.004397, 0.008808
#*# 	-0.012458, -0.010502, 0.014221, 0.015397, -0.003972, 0.008629, 0.020311, 0.000056, 0.000068, 0.022143, 0.022481, 0.000503, 0.001612, 0.021566, 0.007645, -0.006146, 0.015862, 0.003347, -0.009337, 0.000871, 0.010041, 0.000677, -0.008846, 0.010515, 0.000051, -0.007098, 0.003138, 0.014060, 0.008416, 0.001855
#*# 	-0.002140, -0.007116, 0.010683, 0.004142, -0.001959, 0.016059, 0.000081, 0.001709, 0.021151, 0.011555, 0.012787, 0.022122, 0.012349, 0.009817, 0.014956, 0.006494, -0.003549, 0.002556, 0.002441, 0.001044, 0.001171, 0.002746, 0.001535, -0.000684, 0.002598, 0.003513, 0.004402, 0.008723, 0.001399, 0.014040
#*# 	0.001457, 0.013763, -0.007313, 0.005710, 0.017976, 0.008183, 0.009819, 0.010770, 0.011702, 0.012430, 0.013387, 0.011327, 0.011054, 0.010585, 0.019380, 0.008598, -0.001832, 0.017708, 0.007993, -0.005439, 0.016013, 0.004418, -0.005412, 0.015268, 0.004654, -0.003552, 0.016702, 0.010731, 0.003218, 0.013181
#*# 	0.000667, 0.002600, -0.003625, 0.005551, 0.006736, 0.000086, 0.017624, 0.009830, 0.001872, 0.021152, 0.010904, 0.001621, 0.019434, 0.009626, 0.001395, 0.019519, 0.010233, 0.001609, 0.021150, 0.009948, 0.000073, 0.019380, -0.001706, -0.001714, 0.019380, 0.000076, 0.012328, 0.024324, 0.015851, 0.014329
#*# 	0.003363, 0.004252, 0.005230, 0.017748, 0.007520, -0.002612, 0.019560, 0.007964, -0.001809, 0.019428, 0.008006, -0.001812, 0.021207, 0.022926, 0.003026, 0.022923, 0.011289, 0.000088, 0.021817, 0.013237, 0.003497, 0.024491, 0.011153, 0.000023, 0.019404, 0.013634, 0.007163, 0.028187, 0.018390, 0.008546
#*# 	-0.003462, 0.012344, -0.001711, -0.001818, 0.012869, 0.005519, -0.001717, 0.011647, 0.003915, -0.004191, 0.013237, 0.007003, 0.009680, 0.018030, 0.003228, 0.000837, 0.018640, 0.000884, 0.010556, 0.021158, 0.003645, 0.003564, 0.019619, 0.000965, 0.010625, 0.024577, 0.008417, 0.019548, 0.029039, 0.008874
#*# 	0.003786, 0.005144, -0.004373, 0.006218, 0.016023, -0.003419, -0.003949, 0.014111, -0.007031, 0.002802, 0.014054, 0.006160, 0.008695, 0.009255, 0.009603, 0.009081, 0.008399, 0.007962, 0.017603, 0.009089, 0.001827, 0.019430, 0.010643, 0.001649, 0.019369, 0.020816, 0.008863, 0.019030, 0.028087, 0.010286
#*# 	0.002585, 0.010204, -0.005347, 0.003509, 0.011113, 0.004230, 0.003452, 0.001210, 0.000196, 0.000915, 0.001778, 0.004442, 0.015796, 0.006331, -0.001706, 0.015506, 0.005791, -0.002835, 0.013135, 0.014143, -0.001730, 0.008656, 0.017608, -0.000000, 0.009324, 0.019381, 0.014895, 0.016708, 0.016352, 0.014492
#*# 	0.008891, -0.008760, 0.001781, 0.010671, -0.004404, 0.003999, 0.010677, -0.000939, -0.000459, 0.000999, 0.002181, 0.003618, 0.005504, 0.005721, 0.015991, 0.005404, -0.003555, 0.012871, 0.003555, -0.003722, 0.013747, 0.015843, 0.000007, 0.007341, 0.015064, 0.001763, 0.003487, 0.019679, 0.012752, 0.003588
#*# 	-0.008477, 0.005288, 0.005517, -0.005306, 0.002650, 0.008855, -0.007041, -0.001279, 0.007211, 0.000940, 0.002100, 0.004185, 0.004421, 0.006867, 0.005963, 0.006167, 0.012709, 0.004320, -0.002284, 0.014183, 0.007487, -0.000386, 0.014230, 0.013765, -0.001929, 0.006187, 0.014244, -0.000289, 0.009630, 0.017610
#*# 	0.005495, -0.009776, -0.000708, 0.000430, -0.007570, -0.000699, 0.008779, -0.000390, 0.002250, 0.003583, 0.004238, 0.005273, 0.006209, 0.007039, 0.015819, 0.007541, -0.001763, 0.014054, 0.006248, 0.001812, 0.018709, 0.018101, -0.000038, 0.006657, 0.014186, -0.000151, 0.005403, 0.014214, 0.009773, 0.009737
#*# 	-0.002498, -0.005397, 0.000067, -0.000541, -0.001119, -0.001886, -0.000832, 0.001870, 0.004815, 0.012487, 0.006859, 0.001859, 0.007570, 0.008106, 0.003388, 0.007654, 0.012298, -0.000101, 0.002236, 0.019378, 0.015002, 0.008626, 0.017640, 0.016041, 0.003296, 0.006653, 0.014082, 0.007791, 0.010848, 0.012215
#*# 	-0.002503, -0.007194, 0.000590, 0.007077, -0.010751, -0.010748, 0.005965, -0.006983, -0.001719, 0.016235, 0.015991, 0.006138, -0.000185, 0.015862, 0.006722, -0.001865, 0.005706, 0.014196, 0.000088, 0.010603, 0.021096, 0.007072, 0.007139, 0.019523, 0.003572, 0.001696, 0.015825, 0.009102, 0.006237, 0.021164
#*# 	-0.003363, 0.000440, 0.004291, -0.000955, -0.007993, 0.000494, -0.001404, -0.002074, 0.006024, 0.014053, 0.003474, 0.001926, 0.010563, 0.004935, 0.000070, 0.011069, 0.006603, 0.000080, 0.012284, 0.014061, 0.003731, 0.012684, 0.019906, 0.008855, 0.007077, 0.015954, 0.008849, 0.006629, 0.018443, 0.020838
#*# 	-0.009360, -0.006598, -0.004983, -0.000800, -0.012942, -0.006594, 0.001730, -0.005271, -0.001720, 0.010673, -0.000835, -0.003554, 0.008973, 0.007285, -0.003435, 0.004826, 0.010541, -0.003557, -0.005299, 0.008864, 0.004193, 0.003053, 0.016713, 0.012355, 0.005250, 0.007305, 0.011101, 0.008520, 0.008619, 0.014407
#*# 	-0.012438, -0.012526, -0.010879, -0.010479, -0.010202, -0.011025, -0.001602, -0.000810, -0.000001, 0.005587, 0.001071, -0.001742, -0.003599, 0.003724, 0.003148, 0.000097, 0.006075, 0.000038, -0.001558, -0.001916, 0.004544, 0.003482, 0.008563, 0.011444, 0.011395, 0.005417, 0.003588, 0.004296, 0.004481, 0.005957
#*# 	-0.020434, -0.013329, -0.009856, -0.017753, -0.016058, -0.005386, -0.002154, -0.007058, 0.005330, 0.004974, -0.007009, -0.007546, 0.003227, 0.000033, -0.001739, 0.007100, 0.005453, -0.005313, -0.007653, -0.000792, -0.003668, -0.004448, 0.006234, 0.012218, 0.007064, 0.005860, 0.005295, -0.002184, -0.001717, 0.003580
#*# 	-0.015964, -0.015219, -0.015939, -0.014088, -0.013233, -0.012679, -0.007188, -0.003525, -0.002785, -0.005295, -0.003514, -0.004903, -0.006203, -0.001871, 0.002604, -0.001705, -0.001828, -0.001749, -0.006058, -0.007737, -0.003477, -0.001498, -0.003526, 0.001693, 0.008831, 0.002110, -0.001899, 0.000039, -0.000832, -0.005167
#*# 	-0.016877, -0.012078, -0.013355, -0.016070, -0.008891, -0.007089, -0.008857, -0.004700, -0.000885, -0.004359, -0.008890, -0.005374, -0.001820, -0.005298, 0.000160, 0.003576, 0.001679, -0.003724, -0.003535, -0.001825, -0.005316, -0.001813, 0.000390, -0.000159, 0.000600, 0.002118, 0.001722, -0.001924, -0.002600, -0.001835
#*# 	-0.014108, -0.013364, -0.012682, -0.010252, -0.007324, -0.007227, -0.003967, -0.003533, -0.002691, -0.003567, -0.004154, -0.003506, -0.003536, -0.001705, 0.004032, 0.007077, 0.003671, 0.004395, 0.003500, 0.000976, -0.000002, 0.002287, 0.001123, -0.001779, 0.002084, 0.003458, 0.000070, 0.001170, 0.002601, 0.000438
#*# 	-0.012095, -0.008669, -0.008922, -0.007930, -0.002602, -0.004137, -0.003648, -0.001798, -0.000766, -0.002628, -0.001097, -0.000015, -0.000905, -0.001385, 0.005311, 0.008012, 0.006854, 0.005780, 0.007095, 0.005056, 0.004268, 0.005287, 0.001640, -0.000154, -0.000983, 0.000866, 0.003511, 0.003935, 0.003515, 0.001967
#*# 	-0.012112, -0.008986, -0.008944, -0.007146, -0.004900, -0.003645, -0.004186, -0.003395, -0.001833, -0.000093, 0.000186, 0.000152, 0.000742, 0.002084, 0.005402, 0.008047, 0.008855, 0.007884, 0.007186, 0.005634, 0.005074, 0.002114, 0.000668, -0.001666, -0.001771, -0.000044, 0.003395, 0.005384, 0.005284, 0.000416
#*# 	-0.013395, -0.010691, -0.009813, -0.009337, -0.007494, -0.006301, -0.006197, -0.004878, -0.003461, -0.001805, -0.001229, 0.000104, 0.000801, 0.001834, 0.004219, 0.006360, 0.006251, 0.006176, 0.003618, 0.002699, 0.000197, -0.000072, -0.000480, -0.002742, -0.002707, -0.002600, 0.000484, 0.003742, 0.003630, -0.001287
#*# 	-0.017550, -0.013652, -0.010321, -0.010673, -0.008501, -0.007593, -0.006637, -0.006348, -0.005291, -0.003546, -0.002733, -0.001771, -0.001717, -0.000268, 0.001822, 0.001883, 0.003993, 0.003501, 0.000002, -0.001928, -0.001861, -0.001911, -0.002602, -0.003515, -0.004465, -0.003771, -0.001810, 0.001309, 0.000002, -0.003831
#*# 	-0.011568, -0.010609, -0.009302, -0.007928, -0.006899, -0.004449, -0.003502, -0.003549, -0.001859, -0.000340, 0.000012, 0.001421, 0.001905, 0.001884, 0.004171, 0.005245, 0.005371, 0.005311, 0.003500, 0.001432, 0.000972, 0.001455, 0.000052, -0.000194, -0.000879, -0.001328, -0.000052, 0.001305, 0.000012, -0.001200
#*# 	-0.005377, -0.006981, -0.003988, -0.000870, -0.001725, -0.001743, 0.001883, 0.000653, 0.000072, 0.003831, 0.005727, 0.004734, 0.004867, 0.007486, 0.006680, 0.005366, 0.008124, 0.009690, 0.006750, 0.003498, 0.005293, 0.003713, 0.001710, 0.000462, 0.000278, -0.000002, -0.000127, -0.000175, -0.001187, 0.001194
#*# 	0.000946, 0.000954, -0.000098, 0.000496, 0.000903, 0.001528, 0.002794, 0.003508, 0.004584, 0.005379, 0.007302, 0.007963, 0.008887, 0.008842, 0.008866, 0.008472, 0.009085, 0.008971, 0.008784, 0.006627, 0.004282, 0.003291, 0.001751, 0.000075, -0.001741, -0.002025, -0.003933, -0.005235, -0.004617, -0.001480
#*# 	0.005318, 0.003448, 0.001749, 0.002607, 0.000947, 0.000946, 0.003079, 0.005316, 0.007363, 0.007510, 0.010647, 0.010222, 0.008860, 0.010660, 0.008934, 0.007076, 0.008438, 0.010649, 0.009197, 0.006869, 0.005042, 0.003499, 0.000083, -0.001728, -0.003511, -0.005490, -0.007071, -0.008855, -0.007959, -0.005387
#*# tension = 0.2
#*# min_x = 40.0
#*# algo = bicubic
#*# y_count = 30
#*# mesh_y_pps = 2
#*# min_y = 40.0
#*# x_count = 30
#*# max_y = 260.0
#*# mesh_x_pps = 2
#*# max_x = 260.0
#*#
#*# [scanner model default]
#*# model_coef = 1.3637297647578879,
#*# 	1.807525996042669,
#*# 	0.7628806362148711,
#*# 	0.2979360973147329,
#*# 	0.41698140182623084,
#*# 	0.571062121929289,
#*# 	-0.28243053587611877,
#*# 	-0.5706830390017905,
#*# 	0.28945893421728736,
#*# 	0.34735939418792344
#*# model_domain = 3.208606271270468e-07,3.3369927253188336e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 23.724033
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 3250
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.140
